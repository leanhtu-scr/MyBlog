<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mini Social ‚Äî Single File</title>
  <style>
    :root{--accent:#ff3b30;--bg:#000}
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
    body{background:var(--bg);color:#fff;overflow:hidden}

    /* full-screen background video (your exact snippet) */
    #bgVideo{position:fixed;inset:0;width:100%;height:100%;object-fit:cover;z-index:0;filter:brightness(.25)}

    /* header */
    header{position:relative;z-index:10;padding:18px;text-align:center}
    header .logo{font-weight:700;color:var(--accent)}

    /* center stage */
    .stage{position:relative;z-index:10;height:calc(100% - 140px);display:flex;align-items:center;justify-content:center}
    .card{width:92%;max-width:760px;background:rgba(255,255,255,0.06);border-radius:14px;padding:14px;box-shadow:0 6px 30px rgba(0,0,0,0.6)}

    .post-area{min-height:320px;max-height:60vh;overflow:hidden;position:relative}
    .post-content{padding:10px 14px;background:rgba(0,0,0,0.35);border-radius:8px;color:#fff;white-space:pre-wrap}
    .post-meta{color:#f1f1f1;opacity:.85;font-size:13px;margin-top:8px;display:flex;justify-content:space-between}

    .controls{display:flex;gap:10px;align-items:center;margin-top:12px}
    button{background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.1);padding:8px 10px;border-radius:10px;color:#fff}
    input,textarea,select{padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.1);background:rgba(0,0,0,0.25);color:#fff}
    textarea{min-height:80px}

    /* music selector ‚Äî keep your exact HTML, just position & style */
    .music-btn{position:fixed;left:14px;bottom:14px;z-index:20;background:rgba(0,0,0,0.55);padding:10px;border-radius:12px}
    .music-btn select{min-width:210px}

    /* auth panel */
    .auth{position:fixed;left:14px;top:86px;z-index:20;background:rgba(0,0,0,0.6);backdrop-filter:blur(6px);padding:12px;border-radius:12px}

    /* comments overlay (tiktok-like) */
    .comments{position:fixed;right:12px;bottom:12px;width:320px;max-height:60vh;overflow:hidden;z-index:20}
    .comment-list{display:flex;flex-direction:column-reverse;gap:8px;overflow-y:auto;padding:12px;background:linear-gradient(180deg,transparent,rgba(0,0,0,0.6));border-radius:12px}
    .comment{background:rgba(255,255,255,0.06);padding:8px;border-radius:10px;opacity:1;transition:opacity .5s}
    .comment.old{opacity:0.35}

    /* reactions */
    .reactions{display:flex;gap:8px;align-items:center}
    .reaction{cursor:pointer;padding:6px 9px;border-radius:10px;background:rgba(255,255,255,0.08)}

    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:28px;background:#111;padding:10px 14px;border-radius:10px;color:#fff;z-index:40}
    .swipe-hint{position:absolute;left:50%;transform:translateX(-50%);bottom:-36px;color:#ddd;font-size:12px}

    @media(max-width:520px){.comment-list{width:260px}.card{padding:10px}}
  </style>
</head>
<body>

  <!-- === Background Video (exact block you provided) === -->
  <video autoplay muted loop playsinline id="bgVideo">
    <source src="background.mp4" type="video/mp4"> <!-- Video n·ªÅn thay ·ªü ƒë√¢y -->
  </video>

  <header>
    <div class="logo">Mini Social ‚Äî single file</div>
  </header>

  <main class="stage">
    <div class="card" id="card">
      <div id="postArea" class="post-area">
        <div id="postDisplay">
          <div class="post-content" id="postContent">Ch∆∞a c√≥ b√†i vi·∫øt n√†o. H√£y ƒëƒÉng nh·∫≠p ƒë·ªÉ t·∫°o b√†i.</div>
          <div class="post-meta"><div id="postAuthor"></div><div id="postTime"></div></div>
          <div class="swipe-hint">Tr∆∞·ª£t tr√°i/ph·∫£i ƒë·ªÉ xem b√†i tr∆∞·ªõc/sau</div>
        </div>

        <div style="margin-top:12px;display:flex;justify-content:space-between;align-items:center">
          <div class="reactions" id="reactionsArea"></div>
          <div><button id="btnCommentToggle">B√¨nh lu·∫≠n</button></div>
        </div>

        <div id="commentBox" style="display:none;margin-top:10px">
          <input id="commentInput" placeholder="Vi·∫øt b√¨nh lu·∫≠n..." />
          <button id="btnSendComment">G·ª≠i</button>
        </div>
      </div>

      <div id="composer" style="margin-top:12px;display:none">
        <textarea id="postText" placeholder="Vi·∫øt b√†i... (admin kh√¥ng gi·ªõi h·∫°n, user th∆∞·ªùng 1 b√†i/ng√†y)"></textarea>
        <div class="controls">
          <button id="btnPost">ƒêƒÉng</button>
          <button id="btnDelete">X√≥a b√†i (n·∫øu ƒë∆∞·ª£c quy·ªÅn)</button>
          <div style="margin-left:auto;color:#ddd" id="userInfo"></div>
        </div>
      </div>
    </div>
  </main>

  <!-- === Music list (exact block you provided) === -->
  <div class="music-btn">
    <select onchange="changeSong(this.value)">
      <option value="">Play Music</option>
      <!-- Thay nh·∫°c ·ªü ƒë√¢y-->
      <option value="./deanhluongthien.mp3">ƒê·ªÉ Anh L∆∞∆°ng Thi·ªán Remix</option>
      <option value="./emcuoiroia.mp3">Em C∆∞·ªõi R·ªìi √Ä Remix</option>
      <option value="./freemanxlowremix.mp3">Free Man x Low Remix</option>
      <option value="./slayphonk.mp3">Slay Phonk</option>
      <option value="./Nk.mp3">Y√™u em r·∫•t nhi·ªÅu</option>
      <option value="./nghebaitrinhchua.mp3">Nghe B√†i Tr√¨nh Ch∆∞a ??</option>
      <option value="./Quangay.mp3">T·∫°i sao Qu√¢n l√† gay ?</option>
      <option value="./B4BxAdamn.mp3">Mashup Band 4 Band x Adamn</option>
      <option value="./thaproitudo.mp3">Th√°p R∆°i T·ª± Do</option>
    </select>
    <audio id="bgMusic" autoplay loop hidden></audio>
  </div>

  <!-- Auth -->
  <div class="auth" id="authBox">
    <div style="font-weight:700;margin-bottom:6px">T√†i kho·∫£n</div>
    <div id="authForms">
      <div id="registerForm">
        <input id="regUser" placeholder="T√™n t√†i kho·∫£n (cho ph√©p m·ªçi k√≠ t·ª±)" /><br/>
        <input id="regPass" placeholder="M·∫≠t kh·∫©u" type="password" /><br/>
        <div style="margin-top:6px;display:flex;gap:6px">
          <button id="btnRegister">ƒêƒÉng k√Ω</button>
          <button id="btnGoLogin">ƒêƒÉng nh·∫≠p</button>
        </div>
      </div>

      <div id="loginForm" style="display:none">
        <input id="loginUser" placeholder="T√™n t√†i kho·∫£n" /><br/>
        <input id="loginPass" placeholder="M·∫≠t kh·∫©u" type="password" /><br/>
        <div style="margin-top:6px;display:flex;gap:6px">
          <button id="btnLogin">ƒêƒÉng nh·∫≠p</button>
          <button id="btnLogout" style="display:none">ƒêƒÉng xu·∫•t</button>
        </div>
        <div style="margin-top:6px">
          <input id="forgotUser" placeholder="T√™n t√†i kho·∫£n ƒë·ªÉ ƒë·ªïi m·∫≠t kh·∫©u" />
          <button id="btnForgot">Qu√™n m·∫≠t kh·∫©u (m√£ m·∫∑c ƒë·ªãnh: 0)</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Comments overlay -->
  <div class="comments">
    <div style="font-weight:700;margin-bottom:6px">B√¨nh lu·∫≠n (ki·ªÉu livestream)</div>
    <div class="comment-list" id="commentList"></div>
  </div>

  <div id="toastHolder"></div>

  <script>
    /* ====== Storage schema ======
      users: { username: {password, lastPostAt, createdAt} }
      posts: [ {id,author,content,createdAt,reactions:{'‚ù§Ô∏è':0,'üòÇ':0,'üî•':0},comments:[{user,text,ts}] } ]
    */

    // Utilities
    const qs = s => document.querySelector(s);
    const now = ()=> Date.now();
    const uid = ()=> Math.random().toString(36).slice(2,10);

    // Keys
    const USERS_KEY = 'mini_users_v1';
    const POSTS_KEY = 'mini_posts_v1';

    // Admin (hardcoded; not saved)
    const ADMIN_USER = 'admin';
    const ADMIN_PASS = 'admin';

    // Storage helpers
    function loadUsers(){ try{return JSON.parse(localStorage.getItem(USERS_KEY)||'{}')}catch(e){return {}} }
    function saveUsers(u){ localStorage.setItem(USERS_KEY,JSON.stringify(u)) }
    function loadPosts(){ try{return JSON.parse(localStorage.getItem(POSTS_KEY)||'[]')}catch(e){return [] } }
    function savePosts(p){ localStorage.setItem(POSTS_KEY,JSON.stringify(p)) }

    // App state
    let users = loadUsers();
    let posts = loadPosts();
    let currentUser = null; // {username,isAdmin}
    let currentPostIndex = posts.length-1; // newest

    // Elements
    const postContentEl = qs('#postContent');
    const postAuthorEl = qs('#postAuthor');
    const postTimeEl = qs('#postTime');
    const reactionsArea = qs('#reactionsArea');
    const commentListEl = qs('#commentList');
    const commentBox = qs('#commentBox');
    const composer = qs('#composer');
    const userInfoEl = qs('#userInfo');

    // Render post
    function renderPost(){
      if(currentPostIndex < 0 || posts.length===0){
        postContentEl.innerText='Ch∆∞a c√≥ b√†i vi·∫øt n√†o.'; postAuthorEl.innerText=''; postTimeEl.innerText=''; reactionsArea.innerHTML=''; commentListEl.innerHTML=''; return;
      }
      const p = posts[currentPostIndex];
      postContentEl.innerText = p.content;
      postAuthorEl.innerText = 'T√°c gi·∫£: ' + p.author;
      postTimeEl.innerText = new Date(p.createdAt).toLocaleString();

      // reactions
      reactionsArea.innerHTML='';
      for(const e of Object.keys(p.reactions||{})){
        const btn = document.createElement('div');
        btn.className='reaction'; btn.innerText = `${e} ${p.reactions[e]||0}`;
        btn.onclick = ()=>{ p.reactions[e] = (p.reactions[e]||0)+1; savePosts(posts); renderPost(); };
        reactionsArea.appendChild(btn);
      }

      renderComments();
      updateComposerVisibility();
    }

    function renderComments(){
      commentListEl.innerHTML=''; if(currentPostIndex<0) return; const p = posts[currentPostIndex]; p.comments = p.comments || [];
      for(let i=p.comments.length-1;i>=0;i--){ const c=p.comments[i]; const div=document.createElement('div'); div.className='comment'; if(Date.now()-c.ts>180000) div.classList.add('old'); div.innerHTML=`<strong>${escapeHtml(c.user)}</strong>: ${escapeHtml(c.text)} <div style="font-size:11px;color:#ddd">${new Date(c.ts).toLocaleTimeString()}</div>`; commentListEl.appendChild(div);} commentListEl.scrollTop = commentListEl.scrollHeight;
    }

    function escapeHtml(s){ return (s+'').replace(/[&<>"']/g, ch=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;' }[ch])) }

    // Auth
    qs('#btnRegister').onclick = ()=>{
      const u = qs('#regUser').value; const p = qs('#regPass').value;
      if(!u){ alert('Vui l√≤ng nh·∫≠p t√™n t√†i kho·∫£n'); return }
      if(u===ADMIN_USER){ alert('Kh√¥ng th·ªÉ t·∫°o t√†i kho·∫£n t√™n admin.'); return }
      if(users[u]){ alert('T√†i kho·∫£n ƒë√£ t·ªìn t·∫°i'); return }
      users[u] = { password:p, createdAt: now(), lastPostAt: 0 };
      saveUsers(users);
      qs('#loginUser').value = u; qs('#regUser').value=''; qs('#regPass').value='';
      showLogin(); alert('ƒêƒÉng k√Ω th√†nh c√¥ng ‚Äî chuy·ªÉn sang ƒëƒÉng nh·∫≠p');
    }

    qs('#btnGoLogin').onclick = showLogin;
    function showLogin(){ qs('#registerForm').style.display='none'; qs('#loginForm').style.display='block'; }

    qs('#btnLogin').onclick = ()=>{
      const u = qs('#loginUser').value.trim(); const p = qs('#loginPass').value;
      if(!u){ alert('Nh·∫≠p t√†i kho·∫£n'); return }
      if(u===ADMIN_USER && p===ADMIN_PASS){ currentUser={username:ADMIN_USER,isAdmin:true}; afterLogin(); return }
      const uu = users[u]; if(!uu){ alert('T√†i kho·∫£n kh√¥ng t·ªìn t·∫°i'); return }
      if(uu.password!==p){ alert('Sai m·∫≠t kh·∫©u'); return }
      currentUser = {username:u,isAdmin:false}; afterLogin();
    }

    qs('#btnLogout').onclick = ()=>{ currentUser=null; qs('#btnLogout').style.display='none'; userInfoEl.innerText=''; composer.style.display='none'; alert('ƒê√£ ƒëƒÉng xu·∫•t'); }

    qs('#btnForgot').onclick = ()=>{
      const u = qs('#forgotUser').value.trim(); if(!u){ alert('Nh·∫≠p t√†i kho·∫£n'); return }
      if(u===ADMIN_USER){ alert('Kh√¥ng th·ªÉ reset admin qua giao di·ªán'); return }
      if(!users[u]){ alert('Kh√¥ng t·ªìn t·∫°i'); return }
      const code = prompt('Nh·∫≠p m√£ ƒë·ªÉ ƒë·ªïi m·∫≠t kh·∫©u (m√£ m·∫∑c ƒë·ªãnh l√† 0):');
      if(code==='0'){ users[u].password='0'; saveUsers(users); alert('ƒê√£ ƒë·ªïi m·∫≠t kh·∫©u sang 0'); } else alert('M√£ kh√¥ng ƒë√∫ng');
    }

    function afterLogin(){ qs('#btnLogout').style.display='inline-block'; userInfoEl.innerText=`ƒêƒÉng nh·∫≠p: ${currentUser.username}${currentUser.isAdmin?' (admin)':''}`; composer.style.display='block'; qs('#authBox').style.display='none'; renderPost(); }

    function updateComposerVisibility(){ if(!currentUser){ composer.style.display='none'; return } composer.style.display='block'; userInfoEl.innerText=`B·∫°n: ${currentUser.username}${currentUser.isAdmin?' (admin)':''}`; }

    // Posting
    qs('#btnPost').onclick = ()=>{
      if(!currentUser){ alert('B·∫°n ph·∫£i ƒëƒÉng nh·∫≠p'); return }
      const text = qs('#postText').value.trim(); if(!text){ alert('N·ªôi dung r·ªóng'); return }
      if(!currentUser.isAdmin){ const u=users[currentUser.username]; if(now()-(u.lastPostAt||0) < 86400000){ alert('B·∫°n ch·ªâ ƒë∆∞·ª£c ƒëƒÉng 1 l·∫ßn trong 24 gi·ªù'); return } }
      if(!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën ƒëƒÉng b√†i n√†y?')) return;
      const newPost = { id: uid(), author: currentUser.username, content: text, createdAt: now(), reactions:{'‚ù§Ô∏è':0,'üòÇ':0,'üî•':0}, comments:[] };
      posts.push(newPost); savePosts(posts);
      if(!currentUser.isAdmin){ users[currentUser.username].lastPostAt=now(); saveUsers(users); }
      qs('#postText').value=''; currentPostIndex = posts.length-1; renderPost();
    }

    // Delete
    qs('#btnDelete').onclick = ()=>{
      if(currentPostIndex<0) return; const p = posts[currentPostIndex]; if(!currentUser){ alert('ƒêƒÉng nh·∫≠p ƒë·ªÉ x√≥a'); return }
      if(currentUser.isAdmin || p.author===currentUser.username){ if(confirm('X√≥a b√†i n√†y?')){ posts = posts.filter(x=>x.id!==p.id); savePosts(posts); currentPostIndex = posts.length-1; renderPost(); } } else alert('B·∫°n kh√¥ng c√≥ quy·ªÅn x√≥a b√†i n√†y');
    }

    // Comments
    qs('#btnCommentToggle').onclick = ()=>{ commentBox.style.display = commentBox.style.display==='none'?'block':'none' }
    qs('#btnSendComment').onclick = ()=>{ if(currentPostIndex<0){ alert('Ch∆∞a c√≥ b√†i'); return } if(!currentUser){ alert('ƒêƒÉng nh·∫≠p ƒë·ªÉ b√¨nh lu·∫≠n'); return } const t=qs('#commentInput').value.trim(); if(!t) return; const p=posts[currentPostIndex]; p.comments.push({user:currentUser.username,text:t,ts:now()}); savePosts(posts); qs('#commentInput').value=''; renderComments(); }

    // Music (hook into your select/audio)
    const bgMusic = document.getElementById('bgMusic');
    function changeSong(song){ if(song){ bgMusic.src=song; bgMusic.play().catch(()=>{}); } else { bgMusic.pause(); bgMusic.src=''; } }
    window.changeSong = changeSong; // expose for inline onchange

    // Auto-delete posts older than 24h
    function cleanupOldPosts(){ const cutoff = now()-86400000; const before=posts.length; posts = posts.filter(p=>p.createdAt>cutoff); if(before!==posts.length){ savePosts(posts); currentPostIndex = posts.length-1; } }
    setInterval(()=>{ cleanupOldPosts(); renderPost(); }, 60000); cleanupOldPosts();

    // Swipe navigation
    let touchStartX=null; const card=document.getElementById('card');
    function nextPost(){ if(posts.length===0) return; currentPostIndex = Math.max(0, Math.min(posts.length-1, currentPostIndex-1)); renderPost(); }
    function prevPost(){ if(posts.length===0) return; currentPostIndex = Math.max(0, Math.min(posts.length-1, currentPostIndex+1)); renderPost(); }
    card.addEventListener('touchstart',e=>{ touchStartX = e.touches[0].clientX });
    card.addEventListener('touchend',e=>{ if(touchStartX===null) return; const dx=e.changedTouches[0].clientX - touchStartX; if(Math.abs(dx)>50){ if(dx<0) nextPost(); else prevPost(); } touchStartX=null; });

    // Random compliment every 10 minutes (on registered users only)
    function randomBeautyNotice(){ const keys=Object.keys(users); if(keys.length===0) return; const who=keys[Math.floor(Math.random()*keys.length)]; showToast(`${who} ‚Äî b·∫°n th·∫≠t ƒë·∫πp üíñ`,5000); }
    setInterval(randomBeautyNotice, 10*60*1000);

    // Toast helper
    function showToast(msg,ms=3000){ const t=document.createElement('div'); t.className='toast'; t.innerText=msg; document.body.appendChild(t); setTimeout(()=>t.remove(),ms); }

    // Initial render
    function init(){ users = loadUsers(); posts = loadPosts(); currentPostIndex = posts.length-1; renderPost(); }
    init();

    // Expose for debugging
    window._mini = {users,posts,saveUsers,savePosts};
  </script>
</body>
</html>
